{% extends 'front/layout.html.twig' %}
{% trans_default_domain 'user_messages' %}
{% set locale = app.request.locale %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('flp_theme') }}
    {{ encore_entry_link_tags('situ_list_app', null, 'frontApp') }}
    </style>
{% endblock %}

{% block title %}{{ 'contrib.title'|trans() }}{% endblock %}

{% block content %}
    <div id="loader"></div>
    
    <div class="container mt-5 py-5">
        
        {% block banner%}
         <h1 class="h3 mt-3 mb-5 text-white">{{ 'contrib.title'|trans() }}</h1>
        {% endblock %}
        
        <div class="card card bg-secondary-50">
            <div id="situs" class="card-body text-white front-dataTable">
                
                {% if situs is empty %}
                <div class="mb-5 p-3 bg-white-70">
                    {{ 'account.contribs.empty'|trans() }}
                </div>
                {% else %}
                <table id="dataTable-situs" class="shadow table table-borderless table-hover text-nowrap">
                    <thead class="bg-black-40 text-white">
                        <tr>
                            <th class="py-2">{{ 'contrib.table.title'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.description'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.date_creation'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.event'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.category_level1'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.category_level2'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.lang'|trans() }}</th>
                            <th class="py-2">{{ 'contrib.table.status.title'|trans() }}</th>
                            <th class="cust-nowrap p-2 no-sort">{{ 'contrib.table.actions.title'|trans() }}</th>
                            <th class="no-sort"></th>
                            <th class="no-sort"></th>
                        </tr>
                    </thead>
                    <tbody class="small bg-white-80">
                    {% for situ in situs %}
                        {% if situ.statusId != 5 %}
                        <tr data-id="{{ situ.id }}" data-user="{{ app.user.id }}">
                            <th class="pt-3"
                                scope="row" data-toggle="tooltip" data-placement="right" title="{{ situ.title }}">
                                {{ situ.title|u.truncate(20, '...') }}
                            </th>
                            <td class="pt-3"
                                data-toggle="tooltip" data-placement="right" title="{{ situ.description }}">
                                {{ situ.description|u.truncate(20, '...') }}
                            </td>
                            <td class="pt-3"
                                data-toggle="tooltip" data-placement="right" title="{{ situ.dateCreation is empty ? '' : situ.dateCreation|format_datetime('short', 'short', locale=locale) }}">
                                {{ situ.dateCreation|format_datetime('short', 'none', locale=locale) }}
                            </td>
                            <td class="pt-3"
                                data-toggle="tooltip" data-placement="right" title="{{ situ.evtTitle }}">
                                {{ situ.evtTitle|u.truncate(20, '...') }}
                            </td>
                            <td class="pt-3"
                                data-toggle="tooltip" data-placement="right" title="{{ situ.cat1Title }}">
                                {{ situ.cat1Title|u.truncate(20, '...') }}
                            </td>
                            <td class="pt-3"
                                data-toggle="tooltip" data-placement="right" title="{{ situ.cat2Title }}">
                                {{ situ.cat2Title|u.truncate(20, '...') }}
                            </td>
                            <td class="pt-3 first-letter">{{ situ.langName }}</td>
                            <td class="pt-3">
                                {% if situ.statusId == 1 %}
                                    {{ 'contrib.table.status.writing'|trans() }}
                                {% elseif situ.statusId == 2 %}
                                    {{ 'contrib.table.status.validation'|trans() }}
                                {% elseif situ.statusId == 3 %}
                                    {{ 'contrib.table.status.validated'|trans() }}
                                {% else %}
                                    {{ 'contrib.table.status.refused'|trans() }}
                                {% endif %}
                            </td>
                            <td class="width-max-40 px-2">
                                <span role="button" class="situUpdate btn btn-outline-secondary btn-sm px-1"
                                    data-toggle="tooltip" data-placement="left"
                                    title="{{ 'contrib.table.actions.edit'|trans() }}"
                                    aria-label="{{ 'contrib.table.actions.edit'|trans() }}">
                                    <i class="fas fa-pen"></i>
                                </span>
                            </td>
                            {% if situ.statusId == 1 %}
                            <td class="width-max-26 px-0">
                                <span role="button" class="btn btn-outline-success btn-sm pcx-2"
                                    data-id="{{ situ.id }}"
                                    data-toggle="tooltip" data-placement="left"
                                    title="{{ 'contrib.table.actions.validation'|trans() }}">
                                    <i class="far fa-paper-plane"></i>
                                </span>
                            </td>
                            {% elseif situ.statusId == 2 or situ.statusId == 3 %}
                            <td class="width-max-26 px-0">
                                <span role="button" class="btn btn-outline-success btn-sm px-1"
                                    data-id="{{ situ.id }}"
                                    data-toggle="tooltip" data-placement="left"
                                    title="{{ 'contrib.table.actions.read'|trans() }}">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </td>
                            {% else %}
                            <td class="width-max-26 px-0"></td>
                            {% endif %}
                            <td class="width-max-45 px-2">
                                <span role="button" class="btn btn-outline-danger btn-sm"
                                    data-toggle="tooltip" data-placement="left"
                                    title="{{ 'contrib.table.actions.delete'|trans() }}">
                                    <i class="far fa-trash-alt"></i>
                                </span>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
                {% endif %}

            </div>
        </div>
        
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('situ_list_app', null, 'frontApp') }}
    <script>
        var path = { "locale" : "{{ locale }}" }
        var translations = { "flashError" : "{{ 'contrib.form.table.update.flash.error' | trans }}" }
    </script>
{% endblock %}